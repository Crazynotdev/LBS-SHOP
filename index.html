<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connexion ¬∑ LBS SHOP</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* RESET & FONTS */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at 70% 20%, #f0f7fc, #d4e4ee);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.2rem;
    }

    /* CARTE GLASSMORPHISM √âL√âGANTE */
    .card {
      width: 100%;
      max-width: 440px;
      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(18px) saturate(180%);
      -webkit-backdrop-filter: blur(18px) saturate(180%);
      border-radius: 48px;
      padding: 2.2rem 2rem 2.5rem;
      box-shadow: 0 40px 60px -25px rgba(0, 45, 70, 0.4),
                  0 0 0 1px rgba(255, 255, 255, 0.6) inset,
                  0 0 0 1px rgba(0, 80, 120, 0.1);
      transition: all 0.3s cubic-bezier(0.15, 0.85, 0.35, 1.05);
      border: 1px solid rgba(255,255,255,0.45);
    }

    .card:hover {
      box-shadow: 0 50px 75px -20px #0b3f5a;
      transform: translateY(-5px);
    }

    /* LOGO √âL√âGANT */
    .logo-container {
      display: flex;
      justify-content: center;
      margin-bottom: 1.5rem;
    }

    .shop-logo {
      width: auto;
      max-width: 120px;
      height: auto;
      max-height: 70px;
      object-fit: contain;
      border-radius: 24px;
      background: white;
      padding: 8px 16px;
      box-shadow: 0 12px 22px -14px rgba(0,50,70,0.3),
                  0 0 0 1px rgba(255,255,255,0.9) inset;
      transition: transform 0.2s ease;
    }

    .shop-logo:hover {
      transform: scale(1.02);
    }

    /* TITRE */
    h2 {
      font-size: 2rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      background: linear-gradient(145deg, #0b394b, #1c677d);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 1.8rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    h2::after {
      content: "üîê";
      font-size: 1.8rem;
      background: none;
      -webkit-text-fill-color: initial;
      opacity: 0.7;
    }

    /* CHAMPS MODERNES */
    .input-field {
      margin-bottom: 1.2rem;
      position: relative;
    }

    .input-field input {
      width: 100%;
      padding: 1rem 1.4rem;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.8);
      border: 2px solid rgba(160, 195, 215, 0.5);
      border-radius: 38px;
      outline: none;
      transition: all 0.25s ease;
      color: #0e3a4d;
      font-weight: 500;
      box-shadow: 0 4px 10px rgba(0, 35, 50, 0.02);
      backdrop-filter: blur(4px);
    }

    .input-field input:focus {
      border-color: #1a8bb9;
      background: white;
      box-shadow: 0 10px 22px -16px #0f7caa, 0 0 0 4px rgba(20, 130, 180, 0.12);
    }

    .input-field input::placeholder {
      color: #6c92a8;
      font-weight: 400;
      opacity: 0.7;
    }

    /* BOUTON DE CONNEXION */
    .action-btn {
      width: 100%;
      background: linear-gradient(135deg, #0e5e7e, #197ca5);
      border: none;
      padding: 1.1rem 1.8rem;
      font-size: 1.2rem;
      font-weight: 600;
      color: white;
      border-radius: 46px;
      margin: 1.5rem 0 1.8rem;
      cursor: pointer;
      box-shadow: 0 18px 35px -14px #0c546e;
      transition: 0.18s;
      border: 1px solid rgba(255, 255, 255, 0.3);
      letter-spacing: 0.5px;
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .action-btn:hover {
      background: linear-gradient(135deg, #0b4d68, #126f96);
      box-shadow: 0 26px 45px -14px #064053;
      transform: scale(1.02) translateY(-2px);
    }

    .action-btn:active {
      transform: scale(0.99) translateY(2px);
      box-shadow: 0 10px 20px -10px #052a37;
    }

    /* LIEN VERS INSCRIPTION */
    .register-prompt {
      text-align: center;
      font-size: 1rem;
      color: #1b4f65;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      border-top: 2px dotted rgba(80, 140, 170, 0.3);
      padding-top: 1.6rem;
      margin-top: 0.5rem;
    }

    .register-prompt a {
      color: #09618a;
      text-decoration: none;
      font-weight: 700;
      padding: 0.25rem 0.8rem;
      border-radius: 50px;
      background: rgba(255,255,255,0.7);
      transition: all 0.2s;
      border: 1px solid transparent;
    }

    .register-prompt a:hover {
      background: white;
      border-color: #1781ac;
      color: #04384d;
      box-shadow: 0 4px 10px rgba(0,80,110,0.15);
    }

    /* MESSAGE D'ERREUR PERSONNALIS√â */
    .error-message {
      background: rgba(255, 80, 80, 0.1);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 100, 100, 0.3);
      color: #b13e3e;
      padding: 0.8rem 1.2rem;
      border-radius: 60px;
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 1rem;
      display: none;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(200, 50, 50, 0.1);
    }

    .error-message.show {
      display: flex;
    }

    .error-message span {
      font-size: 1.2rem;
    }

    /* RESPONSIVE */
    @media (max-width: 450px) {
      .card {
        padding: 1.8rem 1.2rem 2.2rem;
        border-radius: 38px;
      }
      h2 {
        font-size: 1.8rem;
      }
      .shop-logo {
        max-width: 100px;
        max-height: 60px;
      }
    }
  </style>
</head>
<body>

<div class="card">
  <!-- LOGO -->
  <div class="logo-container">
    <img src="https://files.catbox.moe/g1nwhq.jpg" 
         alt="LBS SHOP" 
         class="shop-logo"
         onerror="this.style.display='none'">
  </div>

  <h2>Connexion</h2>

  <!-- Message d'erreur √©l√©gant -->
  <div class="error-message" id="errorMessage">
    <span>‚ö†Ô∏è</span> <span id="errorText">Identifiants incorrects</span>
  </div>

  <div class="input-field">
    <input id="phone" type="tel" placeholder="T√©l√©phone" autocomplete="tel" value="">
  </div>

  <div class="input-field">
    <input id="password" type="password" placeholder="Mot de passe" autocomplete="current-password">
  </div>

  <button class="action-btn" onclick="login()">
    <span>üîë</span> Se connecter
  </button>

  <div class="register-prompt">
    <span>‚ú® Pas encore de compte ?</span>
    <a href="register.html">Cr√©er un compte</a>
  </div>
</div>

<script>
const API = "https://backend-lbs-shop-59jc.vercel.app/api";

// Fonction pour afficher les erreurs joliment
function showError(message) {
  const errorDiv = document.getElementById('errorMessage');
  const errorText = document.getElementById('errorText');
  errorText.textContent = message || "Identifiants incorrects";
  errorDiv.classList.add('show');
  
  // Faire dispara√Ætre apr√®s 4 secondes
  setTimeout(() => {
    errorDiv.classList.remove('show');
  }, 4000);
}

async function login() {
  const phoneInput = document.getElementById('phone');
  const passwordInput = document.getElementById('password');
  const btn = document.querySelector('.action-btn');

  // Cacher les anciennes erreurs
  document.getElementById('errorMessage').classList.remove('show');

  // Validation rapide
  if (!phoneInput.value.trim() || !passwordInput.value.trim()) {
    showError("Veuillez remplir tous les champs");
    return;
  }

  // Sauvegarder le texte original du bouton
  const originalText = btn.innerHTML;
  btn.innerHTML = '<span>‚è≥</span> Connexion...';
  btn.disabled = true;

  try {
    const res = await fetch(`${API}/auth/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        phone: phoneInput.value.trim(),
        password: passwordInput.value.trim()
      })
    });

    const data = await res.json().catch(() => null);

    if (!res.ok || !data) {
      // Gestion fine des erreurs
      if (res.status === 401) {
        showError("T√©l√©phone ou mot de passe incorrect");
      } else if (res.status === 404) {
        showError("Compte introuvable");
      } else {
        showError(data?.message || "Erreur de connexion");
      }
      
      btn.innerHTML = originalText;
      btn.disabled = false;
      return;
    }

    // Succ√®s !
    localStorage.setItem("user_token", data.token);
    localStorage.setItem("user", JSON.stringify(data.user));
    
    // Petit message de bienvenue personnalis√©
    const userName = data.user?.name || "client";
    alert(`üéâ Bienvenue ${userName} ! Redirection vers la boutique...`);
    
    // Redirection
    location.href = "shop.html";
    
  } catch (error) {
    showError("Probl√®me r√©seau : " + error.message);
    btn.innerHTML = originalText;
    btn.disabled = false;
  }
}

// Ajouter la touche Entr√©e pour soumettre plus facilement
document.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    login();
  }
});
</script>

</body>
</html>
